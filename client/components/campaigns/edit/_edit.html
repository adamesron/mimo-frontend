<camp-nav></camp-nav>

<md-content layout-padding layout="row" layout-wrap class="page-meta">
</md-content>

<md-content class="md-padding" layout="column" layout-gt-sm='row' layout-wrap>
  <div flex layout="column">
  </div>
</md-content>

<form name="myForm" ng-submit="save()">
  <div layout="row" layout-align="center center">
    <md-card flex="100" flex-gt-xs="60" flex-gt-md="60">
      <md-card-title>
        <md-card-title-text>
          <span class="md-headline" translate>
            Create your Campaign
          </span>
        </md-card-title-text>
      </md-card-title>
      <md-card-content>
        <div ng-hide="loading">
          <div layout="row" layout-wrap>
            <md-input-container flex="100" flex-gt-sm="100">
              <label>
                <translate>Campaign Name</translate>
              </label>
              <input md-autofocus ng-model="campaign.campaign_name" name="campaign_name" placeholder="{{ 'Enter a title' | translate }}" type="text" ng-minlength="5" md-maxlength='100' required>
              <div ng-messages="myForm.campaign_name.$error" md-auto-hide="false">
                <div ng-message="max" translate>Must be less than 100 characters</div>
                <div ng-message="min" translate>Must be greater than 5 characters</div>
                <div ng-message="required" translate>Please enter a location name.</div>
              </div>
            </md-input-container>
          </div>
        </div>
      </md-card-content>
    </md-card>
  </div>

  <div layout="row" layout-align="center center">
    <md-card flex="100" flex-gt-xs="60" flex-gt-md="60">
      <md-card-title>
        <md-card-title-text>
          <span class="md-headline" translate>
            Choose Your Audience
          </span>
        </md-card-title-text>
      </md-card-title>
      <md-card-content>
        <p>People who match these rules:</p>
        <md-radio-group ng-model="campaign.template">
          <md-radio-button value="signed_up_now" class="md-primary">Just signed up</md-radio-button>
          <md-radio-button value="signed_up_30" class="md-primary">Signed-up 30 days ago</md-radio-button>
          <md-radio-button value="last_seen_30">Not seen for 30 days</md-radio-button>
          <md-radio-button value="custom">Custom</md-radio-button>
        </md-radio-group>

        <span ng-show="campaign.template == 'custom'">
          <hr>

          <p>People who:</p>
          <md-radio-group ng-model="campaign.predicate_type">
            <md-radio-button value="and" class="md-primary">match all these rules</md-radio-button>
            <md-radio-button value="or" class="md-primary">match any of these rules</md-radio-button>
          </md-radio-group>

          <span ng-repeat="predicate in campaign.predicates">
            <md-card flex="100">
              <md-card-title>
                <md-card-title-text>
                  <span class="md-headline" translate>
                    {{ predicate.name }}
                  </span>
                </md-card-title-text>
              </md-card-title>
              <md-card-content>
                <span ng-hide="focusedCard == $index">
                  <span ng-click="showCard($index)">{{ human(predicate) }}</span>
                </span>
                <span ng-show="focusedCard == $index">
                  <md-radio-group ng-model="predicate.operator" ng-show="predicate.attribute == 'created_at' || predicate.attribute == 'updated_at'">
                    <md-radio-button value="rel_gte" class="md-primary">More than</md-radio-button>
                    <md-radio-button value="rel_lte" class="md-primary">Less than</md-radio-button>
                    <md-radio-button value="rel_eq" class="md-primary">Exactly</md-radio-button>
                    <md-input-container flex="100" flex-gt-sm="100" ng-if="predicate.operator == 'rel_gte' || predicate.operator == 'rel_lte' || predicate.operator == 'rel_eq'">
                      <input ng-model="predicate.rel_value" name="value" placeholder="Days ago" type="number" ng-min="0">
                      <div ng-messages="myForm.value.$error" md-auto-hide="false">
                        <div ng-message="min" translate>Must be more than 0</div>
                        <div ng-message="required" translate>Please enter a number of days.</div>
                      </div>
                    </md-input-container>

                    <md-radio-button value="abs_gte" class="md-primary">After</md-radio-button>
                    <md-radio-button value="abs_lte" class="md-primary">Before</md-radio-button>
                    <md-radio-button value="abs_eq" class="md-primary">On</md-radio-button>

                    <md-input-container flex="100" flex-gt-sm="100" ng-if="predicate.operator == 'abs_gte' || predicate.operator == 'abs_lte' || predicate.operator == 'abs_eq'">

                      <input ng-model="predicate.abs_value" name="value" placeholder="Date" type="date">
                    </md-input-container>
                  </md-radio-group>

                  <md-radio-group ng-model="predicate.operator" ng-show="predicate.attribute == 'logins'">
                    <md-radio-button value="gte" class="md-primary">More than</md-radio-button>
                    <md-radio-button value="lte" class="md-primary">Less than</md-radio-button>
                    <md-input-container flex="100" flex-gt-sm="100">
                      <input ng-model="predicate.value" name="value" placeholder="Count" type="number" ng-min="0">
                      <div ng-messages="myForm.value.$error" md-auto-hide="false">
                        <div ng-message="min" translate>Must be more than 0</div>
                        <div ng-message="required" translate>Please enter a number of days.</div>
                      </div>
                    </md-input-container>
                  </md-radio-group>
                </span>
              </md-card-content>
              <md-card-actions layout="row" layout-align="end center">
                <md-icon ng-click="removePredicate($index)">delete</md-icon>
              </md-card-actions>
            </md-card>
          </span>

          <md-list flex ng-show="showChooser">
            <md-subheader class="md-no-sticky">Person data</md-subheader>
            <md-list-item class="md-2-line" ng-repeat="item in available_options" ng-click="onSelect($index)">
              <div class="md-list-item-text" layout="column">
                <h3>{{ item.name }}</h3>
                <p>{{ item.desc }}</p>
              </div>
            </md-list-item>
          </md-list>

          <md-button class="md-raised" ng-click="addRule()" ng-hide="showChooser">Add a rule</md-button>

        </span>

        <p ng-hide="campaign.template == 'custom'">Include a section here that explains what each one is unless custom</p>
      </md-card-content>
    </md-card>
      <!-- </md-card-content> -->
      <!-- <md-card-actions layout="row" layout-align="end center" ng-hide="loading"> -->
        <!-- <md-button type="submit" class="md-raised" ng-disabled="myForm.$pristine || myForm.$invalid"> -->
          <!-- Next -->
        <!-- </md-button> -->
      <!-- </md-card-actions> -->
  </div>
</form>
