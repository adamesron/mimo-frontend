<md-toolbar class="md-table-toolbar md-default">
  <div class="md-toolbar-tools">
    <md-button id="main" class="md-icon-button md-primary" ng-click="back()" aria-label="{{ 'Settings' | translate }}">
      <md-icon md-font-icon="arrow_back">arrow_back</md-icon>
    </md-button>
    <p translate>Campaigns</p>
    <md-menu ng-if="menu.length">
      <md-button aria-label="{{ 'Open Tools' | translate }}" class="md-icon-button" ng-click="$mdOpenMenu($event)">
        <md-icon>more_vert</md-icon>
      </md-button>
      <md-menu-content width="4">
        <md-menu-item ng-repeat="item in menu">
          <md-button ng-disabled="item.disabled" ng-click="action(item.type)">
            <md-icon ng-if="item.icon" md-menu-origin md-font-icon="{{ item.icon }}">{{ item.icon }}</md-icon>
            {{item.name}}
          </md-button>
        </md-menu-item>
      </md-menu-content>
    </md-menu>
  </div>
  <md-divider></md-divider>
</md-toolbar>

<form name="myForm" ng-submit="save(myForm)">
  <md-content class="md-padding" layout="column" layout-gt-sm='column'>
    <div layout="row" layout-align="center center">
      <div flex="100" flex-gt-sm="75">
        <md-card>
          <md-card-title>
            <md-card-title-text>
              <span class="md-headline" translate>
                <span ng-if="!trigger.id" translate>Name your Campaign</span>
                <span ng-if="trigger.id" translate>{{ trigger.trigger_name }} Campaign</span>
              </span>
              <span class="md-subhead" ng-if="trigger.id" translate>
                Campaign ID: {{ ::trigger.id }}
              </span>
            </md-card-title-text>
          </md-card-title>
          <md-card-content>
            <md-input-container layout="column">
              <label>
                <translate>Campaign Name</translate>
              </label>
              <input type="text" name="trigger_name" md-maxlength="50" ng-model="trigger.trigger_name" placeholder="{{ 'My Handy Trigger' | translate }}" required md-autofocus></input>
              <div ng-messages="myForm.trigger_name.$error">
                <div ng-message="required"  translate>Please enter a name for your campaign</div>
                <div ng-message="md-maxlength" translate>Must be less than 50 characters</div>
              </div>
            </md-input-container>
            <md-input-container layout="column" ng-if="trigger.id && trigger.trigger_event == 'action'" style="margin: 40px 0 10px 0">
              <label>
                <translate>Campaign URL</translate>
              </label>
              <input type="{{ showpassword == true ? 'text' : 'password' }}" ng-focus="showpassword = !showpassword" ng-blur="showpassword = !showpassword" name="trigger_url" ng-model="trigger.action_url" readonly="readonly"></input>
            </md-input-container>
            <small class="muted" style="font-size: 75%;" ng-if="trigger.id && trigger.trigger_event == 'action'" translate>The unique URL to run trigger. Supports POST or GET requests. <b>Keep this secret!</b></small>

            <md-switch ng-model="trigger.active" aria-label="{{ 'Active' | translate }}" ng-change="active()" class="md-warn" ng-show="trigger.id">
              <span ng-if="trigger.active" translate>Campaign Active</span>
              <span ng-if="!trigger.active" translate>Campaign Disabled</span>
            </md-switch>
          </md-card-content>

        </md-card>
        <md-card>
          <md-card-title>
            <md-card-title-text>
              <span class="md-headline" translate>
                Choose an Event
              </span>
              <span class="md-subhead" ng-hide="trigger.locked" translate>
                First you need to choose an event type.
              </span>
              <span class="md-subhead" ng-show="trigger.locked" translate>
                This is a system trigger and is locked, you can't adjust some settings.
              </span>
            </md-card-title-text>
          </md-card-title>
          <md-card-content>
            <md-input-container layout="column">
              <label>
                <translate>Event</translate>
              </label>
              <md-select ng-model="trigger.type" ng-disabled="trigger.locked || trigger.id">
                <md-option ng-repeat="type in triggers | orderBy:'value'" value="{{type.value}}">
                  {{ type.key }}
                </md-option>
              </md-select>
            </md-input-container>

            <md-radio-group ng-model="trigger.trigger_event" layout="row" ng-disabled="trigger.id" ng-show="trigger.type != '_all' && location.slug" ng-change="resetTypes()">
              <md-radio-button value="notify">
                <translate>
                  Create Notification
                </translate>
              </md-radio-button>
              <md-radio-button value="action">
                <translate>
                  Perform Action
                </translate>
              </md-radio-button>
            </md-radio-group>

            <p ng-if="trigger.type == 'action'"><small translate>Send triggers when an action run.</small></p>
            <p ng-if="trigger.type == 'box'"><small translate>Send triggers when something happens to your boxes.</small></p>
            <p ng-if="trigger.type == 'client'"><small translate>Send a trigger when your wireless clients cause an event.</small></p>
            <p ng-if="trigger.type == 'email'"><small translate>When an email address is captured, send a trigger.</small></p>
            <p ng-if="trigger.type == 'guest'"><small translate>Send triggers when a guest causes an event</small></p>
            <p ng-if="trigger.type == 'location'"><small translate>Send triggers when one of your locations causes an event.</small></p>
            <p ng-if="trigger.type == 'network'"><small translate>Send triggers when your networks cause an event.</small></p>
            <p ng-if="trigger.type == 'quickcode'"><small translate>Send triggers when QuickCodes cause an event.</small></p>
            <p ng-if="trigger.type == 'rogue'"><small translate>Send triggers when rogue devices checkin</small></p>
            <p ng-if="trigger.type == 'splash'"><small translate>Send triggers on splash page events</small></p>
            <p ng-if="trigger.type == 'social'"><small translate>Send triggers when a Social login causes a trigger.</small></p>
            <p ng-if="trigger.type == 'store'"><small translate>Send triggers when a store creates an event.</small></p>
            <p ng-if="trigger.type == 'voucher'"><small translate>Send a trigger when a vouchers creates a trigger</small></p>
            <p ng-if="trigger.type == 'zone'"><small translate>Send triggers when changes happen to a zone.</small></p>

            <p ng-if="trigger.type == 'user'"><small translate>Send triggers when changes happen to a user.</small></p>
            <p ng-if="trigger.type == 'brand'"><small translate>Send triggers when changes happen to a brand.</small></p>
            <p ng-if="trigger.type == 'project'"><small translate>Send triggers when changes happen to a project.</small></p>
            <p ng-if="trigger.type == 'project_user'"><small translate>Send triggers when project users are updated.</small></p>

          </md-card-content>
        </md-card>

        <div>

          <md-card ng-if="trigger.channel">
            <md-card-title>
              <md-card-title-text>
                <span class="md-headline">
                  <span ng-show="trigger.channel == 'email'" translate>Send an Email</span>
                </span>
              </md-card-title-text>
            </md-card-title>
            <md-card-content>
              <trigger-tags type="{{trigger.type}}" channel="{{trigger.channel}}" location="{{ location.slug }}"></trigger-tags>
              <span channel-types ver='{{ trigger.channel }}'></span>
            </md-card-content>
          </md-card>
        </div>

        <md-card ng-if="trigger.trigger_type && (trigger.channel || trigger.trigger_event == 'action')">
          <md-card-title>
            <md-card-title-text>
              <span class="md-headline" translate>
                Advanced Settings
              </span>
              <span class="md-subhead" translate>
                Deferring the trigger will queue it and send it after the event has occurred.
              </span>
            </md-card-title-text>
          </md-card-title>

          <md-card-content>
            <div layout-gt-sm="column" layout="column" flex-gt-xs="60" flex="100">
              <md-input-container ng-if="trigger.trigger_event == 'notify'">
                <label>
                  <translate>Defer Minutes</translate>
                </label>
                <input type="text" name="ttl" md-maxlength="100" ng-model="trigger.ttl" placeholder="{{ 'Defer for minutes' | translate }}"></input>
                <div ng-messages="myForm.ttl.$error">
                  <div ng-message="md-max" translate>Must be less than 100 chars</div>
                </div>
              </md-input-container>

              <span ng-if="trigger.trigger_event == 'notify'" layout="column">
                <md-input-container style="margin: 0 0 -20px -3px;">
                  <label>
                    <translate>Match</translate>
                  </label>
                  <input type="text" name="match" md-maxlength="255" ng-model="trigger.match" placeholder="{{ 'Expression match' | translate }}"></input>
                  <div ng-messages="myForm.match.$error">
                    <div ng-message="md-maxlength" translate>Must be less than 255 characters</div>
                  </div>
                </md-input-container>
                <small class="muted" style="font-size: 75%;" translate>Regex match on description, AP Mac or Zone ID.</small>
              </span>

              <md-input-container style="margin: 40px 0 0 -3px;" ng-if="trigger.trigger_event == 'action'">
                <label>
                  <translate>Authorized IPs</translate>
                </label>
                <input md-maxlength="255" name="ips" type="text" name="tags" ng-model="trigger.authorized_ips" placeholder="{{ 'Authorized IPs' | translate }}"></input>
                <div ng-messages="myForm.ips.$error">
                  <div ng-message="md-maxlength" translate>Must be less than 255 characters</div>
                </div>
                <small class="muted" style="font-size: 75%; margin-top: -20px" translate>Whitelist IP addresses.</small>
              </md-input-container>

              <md-input-container style="margin: 40px 0 0 -3px;">
                <label>
                  <translate>Tags</translate>
                </label>
                <input md-maxlength="255" type="text" name="tags" ng-model="trigger.tags" placeholder="{{ 'Tags' | translate }}"></input>
                <div ng-messages="myForm.tags.$error">
                  <div ng-message="md-maxlength" translate>Must be less than 128 characters</div>
                </div>
                <small class="muted" style="font-size: 75%; margin-top: -20px" translate>Match any object tags.</small>
              </md-input-container>

            </div>

            <div layout-gt-sm="row" layout="column" flex="100" ng-if="trigger.trigger_event == 'notify'">
              <div style="margin-top: 1px;">
                <p><small translate>Allowed Days</small></p>
                <day-selector active="true" days="trigger.allowed_days" array="trigger.periodic_days"></day-selector>
              </div>
            </div>

            <span ng-if="trigger.trigger_event == 'notify'">
              <p><small translate>Allowed Hours</small></p>
              <div layout-gt-sm="row" flex="100" flex-gt-xs="60" style="margin: 10px 0 -20px 0">
                <md-input-container class="md-block" flex-gt-sm>
                  <label>
                    <translate>Start Hour</translate>
                  </label>
                  <md-select ng-model="trigger.start_hour">
                    <md-option ng-repeat="hour in hours" value="{{ hour.value }}">
                      {{ hour.key }}
                    </md-option>
                  </md-select>
                </md-input-container>
                <md-input-container class="md-block" flex-gt-sm>
                  <label>
                    <translate>End Hour</translate>
                  </label>
                  <md-select ng-model="trigger.end_hour">
                    <md-option ng-repeat="hour in hours" value="{{ hour.value }}">
                      {{ hour.key }}
                    </md-option>
                  </md-select>
                </md-input-container>
              </div>
            </span>

            <small class="muted" style="font-size: 75%;" translate>Triggers will run all day if you set Start and End to 12am.</small>

            <span ng-show="brand.id">
              <md-switch ng-model="trigger.template" aria-label="Switch">
                <translate>
                  Location Template
                </translate>
              </md-switch>
              <small class="muted" style="font-size: 75%;" translate>Template triggers won't fire for brand events. Instead, they will be added to your locations as default triggers.</small>
            </span>
          </md-card-content>
        </md-card>

        <md-button type="submit" ng-disabled="myForm.$invalid || myForm.$pristine || trigger.type == '_all'" class="md-raised"><translate>Save</translate></md-button>
      </div>
    </div>
  </md-content>
</form>
